INFO:ice_data_ingestion.ice_integration:ICE LightRAG system initialized successfully
INFO:ice_data_ingestion.ice_integration:ICE LightRAG system initialized successfully
INFO:updated_architectures.implementation.ice_simplified:ICE Core initializing with ICESystemManager orchestration
INFO:src.ice_core.ice_system_manager:ICE System Manager initialized with working_dir: ice_lightrag/storage
INFO:updated_architectures.implementation.ice_simplified:✅ ICESystemManager initialized successfully
INFO:updated_architectures.implementation.ice_simplified:Data Ingester initialized with 4 API services
INFO:updated_architectures.implementation.ice_simplified:Query Engine initialized
INFO:updated_architectures.implementation.ice_simplified:✅ ICE Simplified system initialized successfully
INFO:src.ice_core.ice_system_manager:LightRAG wrapper created successfully (lazy initialization mode)
INFO:src.ice_core.ice_system_manager:Exa MCP connector initialized successfully
INFO:src.ice_core.ice_graph_builder:ICE Graph Builder initialized
INFO:src.ice_core.ice_graph_builder:LightRAG instance updated in Graph Builder
INFO:src.ice_core.ice_system_manager:Graph Builder initialized successfully
INFO:src.ice_core.ice_query_processor:ICE Query Processor initialized
INFO:src.ice_core.ice_system_manager:Query Processor initialized successfully
INFO:updated_architectures.implementation.ice_simplified:System health: ready=True
INFO:updated_architectures.implementation.ice_simplified:Components: {'lightrag': True, 'exa_connector': True, 'graph_builder': True, 'query_processor': True, 'data_manager': False}
INFO:updated_architectures.implementation.ice_simplified:✅ ICE system created and ready for operations
test_1_full_data_pipeline (__main__.TestIntegration.test_1_full_data_pipeline)
Test 1: Full data pipeline (API → Email → SEC → LightRAG graph) ... FAIL
test_2_circuit_breaker_activation (__main__.TestIntegration.test_2_circuit_breaker_activation)
Test 2: Circuit breaker activation (force API failure, verify retry) ... INFO:ice_data_ingestion.robust_client:Created connection pool for test_service
WARNING:urllib3.connectionpool:Retrying (Retry(total=2, connect=None, read=None, redirect=None, status=None)) after connection broken by 'NewConnectionError('<urllib3.connection.HTTPSConnection object at 0x1440c5290>: Failed to establish a new connection: [Errno 8] nodename nor servname provided, or not known')': /api
WARNING:urllib3.connectionpool:Retrying (Retry(total=1, connect=None, read=None, redirect=None, status=None)) after connection broken by 'NewConnectionError('<urllib3.connection.HTTPSConnection object at 0x1440c5a10>: Failed to establish a new connection: [Errno 8] nodename nor servname provided, or not known')': /api
WARNING:urllib3.connectionpool:Retrying (Retry(total=0, connect=None, read=None, redirect=None, status=None)) after connection broken by 'NewConnectionError('<urllib3.connection.HTTPSConnection object at 0x1440c63d0>: Failed to establish a new connection: [Errno 8] nodename nor servname provided, or not known')': /api
WARNING:ice_data_ingestion.robust_client:Attempt 1 failed: HTTPSConnectionPool(host='invalid-domain-that-does-not-exist-12345.com', port=443): Max retries exceeded with url: /api (Caused by NewConnectionError('<urllib3.connection.HTTPSConnection object at 0x1440c6f10>: Failed to establish a new connection: [Errno 8] nodename nor servname provided, or not known')). Retrying in 0.78s...
WARNING:urllib3.connectionpool:Retrying (Retry(total=2, connect=None, read=None, redirect=None, status=None)) after connection broken by 'NewConnectionError('<urllib3.connection.HTTPSConnection object at 0x1440d06d0>: Failed to establish a new connection: [Errno 8] nodename nor servname provided, or not known')': /api
WARNING:urllib3.connectionpool:Retrying (Retry(total=1, connect=None, read=None, redirect=None, status=None)) after connection broken by 'NewConnectionError('<urllib3.connection.HTTPSConnection object at 0x1440d1150>: Failed to establish a new connection: [Errno 8] nodename nor servname provided, or not known')': /api
WARNING:urllib3.connectionpool:Retrying (Retry(total=0, connect=None, read=None, redirect=None, status=None)) after connection broken by 'NewConnectionError('<urllib3.connection.HTTPSConnection object at 0x1440d1cd0>: Failed to establish a new connection: [Errno 8] nodename nor servname provided, or not known')': /api
WARNING:ice_data_ingestion.robust_client:Attempt 2 failed: HTTPSConnectionPool(host='invalid-domain-that-does-not-exist-12345.com', port=443): Max retries exceeded with url: /api (Caused by NewConnectionError('<urllib3.connection.HTTPSConnection object at 0x1440d2790>: Failed to establish a new connection: [Errno 8] nodename nor servname provided, or not known')). Retrying in 1.63s...
WARNING:urllib3.connectionpool:Retrying (Retry(total=2, connect=None, read=None, redirect=None, status=None)) after connection broken by 'NewConnectionError('<urllib3.connection.HTTPSConnection object at 0x1440d3350>: Failed to establish a new connection: [Errno 8] nodename nor servname provided, or not known')': /api
WARNING:urllib3.connectionpool:Retrying (Retry(total=1, connect=None, read=None, redirect=None, status=None)) after connection broken by 'NewConnectionError('<urllib3.connection.HTTPSConnection object at 0x1440d3dd0>: Failed to establish a new connection: [Errno 8] nodename nor servname provided, or not known')': /api
WARNING:urllib3.connectionpool:Retrying (Retry(total=0, connect=None, read=None, redirect=None, status=None)) after connection broken by 'NewConnectionError('<urllib3.connection.HTTPSConnection object at 0x1440dc990>: Failed to establish a new connection: [Errno 8] nodename nor servname provided, or not known')': /api
ERROR:ice_data_ingestion.robust_client:All 3 attempts failed
ERROR
test_3_secure_config_roundtrip (__main__.TestIntegration.test_3_secure_config_roundtrip)
Test 3: SecureConfig roundtrip (encrypt/decrypt, verify rotation) ... ok
test_4_query_fallback_cascade (__main__.TestIntegration.test_4_query_fallback_cascade)
Test 4: Query fallback cascade (force mix failure → hybrid → local) ... INFO:src.ice_core.ice_system_manager:ICE query completed: mode=mix, graph_context=True
INFO:updated_architectures.implementation.ice_simplified:Query completed: 28 chars, mode: mix
ok
test_5_health_monitoring_metrics (__main__.TestIntegration.test_5_health_monitoring_metrics)
Test 5: Health monitoring metrics collection ... INFO:src.ice_core.ice_system_manager:ICE query completed: mode=local, graph_context=True
INFO:updated_architectures.implementation.ice_simplified:Query completed: 10 chars, mode: local
ok

======================================================================
ERROR: test_2_circuit_breaker_activation (__main__.TestIntegration.test_2_circuit_breaker_activation)
Test 2: Circuit breaker activation (force API failure, verify retry)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/Users/royyeo/anaconda3/lib/python3.11/site-packages/urllib3/connection.py", line 174, in _new_conn
    conn = connection.create_connection(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/royyeo/anaconda3/lib/python3.11/site-packages/urllib3/util/connection.py", line 72, in create_connection
    for res in socket.getaddrinfo(host, port, family, socket.SOCK_STREAM):
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/royyeo/anaconda3/lib/python3.11/socket.py", line 962, in getaddrinfo
    for res in _socket.getaddrinfo(host, port, family, type, proto, flags):
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
socket.gaierror: [Errno 8] nodename nor servname provided, or not known

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/royyeo/anaconda3/lib/python3.11/site-packages/urllib3/connectionpool.py", line 715, in urlopen
    httplib_response = self._make_request(
                       ^^^^^^^^^^^^^^^^^^^
  File "/Users/royyeo/anaconda3/lib/python3.11/site-packages/urllib3/connectionpool.py", line 404, in _make_request
    self._validate_conn(conn)
  File "/Users/royyeo/anaconda3/lib/python3.11/site-packages/urllib3/connectionpool.py", line 1058, in _validate_conn
    conn.connect()
  File "/Users/royyeo/anaconda3/lib/python3.11/site-packages/urllib3/connection.py", line 363, in connect
    self.sock = conn = self._new_conn()
                       ^^^^^^^^^^^^^^^^
  File "/Users/royyeo/anaconda3/lib/python3.11/site-packages/urllib3/connection.py", line 186, in _new_conn
    raise NewConnectionError(
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPSConnection object at 0x1440dd510>: Failed to establish a new connection: [Errno 8] nodename nor servname provided, or not known

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/royyeo/anaconda3/lib/python3.11/site-packages/requests/adapters.py", line 644, in send
    resp = conn.urlopen(
           ^^^^^^^^^^^^^
  File "/Users/royyeo/anaconda3/lib/python3.11/site-packages/urllib3/connectionpool.py", line 827, in urlopen
    return self.urlopen(
           ^^^^^^^^^^^^^
  File "/Users/royyeo/anaconda3/lib/python3.11/site-packages/urllib3/connectionpool.py", line 827, in urlopen
    return self.urlopen(
           ^^^^^^^^^^^^^
  File "/Users/royyeo/anaconda3/lib/python3.11/site-packages/urllib3/connectionpool.py", line 827, in urlopen
    return self.urlopen(
           ^^^^^^^^^^^^^
  File "/Users/royyeo/anaconda3/lib/python3.11/site-packages/urllib3/connectionpool.py", line 799, in urlopen
    retries = retries.increment(
              ^^^^^^^^^^^^^^^^^^
  File "/Users/royyeo/anaconda3/lib/python3.11/site-packages/urllib3/util/retry.py", line 592, in increment
    raise MaxRetryError(_pool, url, error or ResponseError(cause))
urllib3.exceptions.MaxRetryError: HTTPSConnectionPool(host='invalid-domain-that-does-not-exist-12345.com', port=443): Max retries exceeded with url: /api (Caused by NewConnectionError('<urllib3.connection.HTTPSConnection object at 0x1440dd510>: Failed to establish a new connection: [Errno 8] nodename nor servname provided, or not known'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/royyeo/Library/CloudStorage/OneDrive-NationalUniversityofSingapore/Capstone Project/updated_architectures/implementation/test_integration.py", line 100, in test_2_circuit_breaker_activation
    response = client.request("GET", invalid_url)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/royyeo/Library/CloudStorage/OneDrive-NationalUniversityofSingapore/Capstone Project/ice_data_ingestion/robust_client.py", line 441, in request
    response = make_request()
               ^^^^^^^^^^^^^^
  File "/Users/royyeo/Library/CloudStorage/OneDrive-NationalUniversityofSingapore/Capstone Project/ice_data_ingestion/robust_client.py", line 219, in wrapper
    return self._execute_with_retry(func, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/royyeo/Library/CloudStorage/OneDrive-NationalUniversityofSingapore/Capstone Project/ice_data_ingestion/robust_client.py", line 248, in _execute_with_retry
    raise last_exception
  File "/Users/royyeo/Library/CloudStorage/OneDrive-NationalUniversityofSingapore/Capstone Project/ice_data_ingestion/robust_client.py", line 236, in _execute_with_retry
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/royyeo/Library/CloudStorage/OneDrive-NationalUniversityofSingapore/Capstone Project/ice_data_ingestion/robust_client.py", line 434, in make_request
    return self.circuit_breaker.call(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/royyeo/Library/CloudStorage/OneDrive-NationalUniversityofSingapore/Capstone Project/ice_data_ingestion/robust_client.py", line 138, in call
    result = func(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/royyeo/Library/CloudStorage/OneDrive-NationalUniversityofSingapore/Capstone Project/ice_data_ingestion/robust_client.py", line 369, in wrapper
    return request_func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/royyeo/anaconda3/lib/python3.11/site-packages/requests/sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/royyeo/anaconda3/lib/python3.11/site-packages/requests/sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/royyeo/anaconda3/lib/python3.11/site-packages/requests/adapters.py", line 677, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPSConnectionPool(host='invalid-domain-that-does-not-exist-12345.com', port=443): Max retries exceeded with url: /api (Caused by NewConnectionError('<urllib3.connection.HTTPSConnection object at 0x1440dd510>: Failed to establish a new connection: [Errno 8] nodename nor servname provided, or not known'))

======================================================================
FAIL: test_1_full_data_pipeline (__main__.TestIntegration.test_1_full_data_pipeline)
Test 1: Full data pipeline (API → Email → SEC → LightRAG graph)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/Users/royyeo/Library/CloudStorage/OneDrive-NationalUniversityofSingapore/Capstone Project/updated_architectures/implementation/test_integration.py", line 66, in test_1_full_data_pipeline
    self.assertTrue(components['entities_vdb']['exists'],
AssertionError: False is not true : Entity vector DB should exist

----------------------------------------------------------------------
Ran 5 tests in 9.242s

FAILED (failures=1, errors=1)

======================================================================
Starting Integration Test Suite
======================================================================

======================================================================
INTEGRATION TEST SUITE - Week 6
======================================================================
✅ LightRAG successfully imported!

======================================================================
TEST 1: Full Data Pipeline Integration
======================================================================

======================================================================
TEST 2: Circuit Breaker & Retry Logic
======================================================================

======================================================================
TEST 3: SecureConfig Encryption/Decryption
======================================================================
✅ SecureConfig encryption validated
   - Encryption/decryption roundtrip successful
   - Key rotation mechanism available

======================================================================
TEST 4: Query Fallback Logic
======================================================================
✅ Query fallback logic validated
   Requested mode: mix
   Actual mode used: mix
   Fallback triggered: No
   - System gracefully handles mode failures

======================================================================
TEST 5: Health Monitoring & Metrics
======================================================================
✅ Health monitoring validated
   System ready: True
   Query modes available: 6
   Storage size: 0.00 MB
   Sample query time: 0.00s
   - All health indicators operational

======================================================================
INTEGRATION TEST SUMMARY
======================================================================
Tests run: 5
Successes: 3
Failures: 1
Errors: 1

⚠️  Some integration tests failed - review output above
======================================================================
